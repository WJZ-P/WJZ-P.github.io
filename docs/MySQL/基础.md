# MySQL学习笔记

### 学习[小林coding的MySQL笔记](https://xiaolincoding.com/mysql)

#### 一条SQL语句如何查询？

MySQL查询时，首先进行的就是客户端连接上连接器。经历了TCP三次握手后建立连接。此时再修改该用户的权限，是不会对已经连接成功的用户造成影响的。
MySQL的架构分为Server层和存储引擎层，Server层负责建立连接、分析和执行SQL。存储引擎层负责数据的存储与提取。

MySQL的空闲连接会进行处理。默认是断开空闲超过八小时的连接。但是注意，断开之后，客户端是无法马上知道自己的连接已经被断开了的。只有在客户端发起下个请求的时候，才会收到报错 
```ERROR 2013 (HY000): Lost connection to MySQL server during query".```
那么如何解决长连接占用问题？一个是定期断开长连接、另一种是客户端主动重置连接。

MySQL的连接数也有限制，默认是151个。

接着在MySQL收到SQL语句之后，假如是查询语句，那么在MySQL8.0之前的版本会默认使用缓存，查到了就直接返回，但是实际上很鸡肋，命中率不高。

下一步就是开始执行SQL了！首先会交接给解析器，进行词法分析和语法分析。

接着会交给预处理器，它会**检查SQL语句中将要查询的表或字段是否存在，并将查询语句中的“ \* ”扩展为表上所有的字段。**

下一步就交给优化器，它会选择查询成本最小的一种方式执行SQL语句。