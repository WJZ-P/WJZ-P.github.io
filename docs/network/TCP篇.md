# 小林coding的TCP篇！

先来一个超级无敌长提纲！
![image](https://cdn.xiaolincoding.com//mysql/other/1310bf5ed78e4c8186481c47719e0793.png)

## TCP基本认识

### TCP头格式有哪些？

- 序列号：在建立连接时由计算机生成的随机数作为其初始值，通过SYN包传给接收端主机，每发送一次数据就累加一次，用来解决网络包乱序的问题。
- 确认应答号：指下一次期望收到的数据的序列号，发送端收到这个确认应答之后，可以认为该序号之前的数据都已经被正确接收，是用来解决丢包问题。
- 控制位：
  - ACK：为1时，确认应答字段有效。TCP规定，除了最初建立连接时的SYN包之外，该位置必须设置为1.
  - RST：为1时，说明出现异常，必须强制断开连接，就是reset的意思
  - SYN：为1时，表示希望建立连接，并在序列号字段进行序列号初始值设定，意思应该是，syn为1，那么SEQ数值就是序列号的初始值。
  - FIN：表示今后不会再有数据发送，希望断开连接。当通信结束希望断开连接时，通信双方的主机之间就可以相互交换 FIN 位为 1 的 TCP 段。

### 为什么需要TCP协议？TCP工作在哪一层？
IP层，也就是网络层，是不可靠的，不保证网络包的交付、按序交付、不保证完整性。

如果要保障数据包的可靠性，就需要由上层TCP协议来负责。

TCP是工作在传输层的可靠的数据传输服务，确保接收端收到的是无损坏、无间隔、非冗余和按序的。

### 什么是TCP？
TCP是面向连接的、可靠的基于字节流的传输协议。
- 面向连接：一定是一对一的，不能像UDP协议一样可以一个主机同时向多个主机发送消息，一对多是无法做到的。
- 可靠的：无论网络链路如何变化，TCP保证一个报文一定能到达接收端。
- 字节流：用户消息通过TCP传输时，数据可能会被操作系统分组成多个TCP包。那么接收方需要知道消息的边界才能读取出有效的用户消息。并且TCP是有序的，当前一个TCP报文没有收到，即使收到了后面的，也不会给应用层处理。重复的TCP报文会自动丢弃。

### 什么是TCP连接？
用于保证可靠性和流量维护的信息的集合称为一个连接，如socket、序列号和窗口大小。

建立一个TCP连接，需要客户端和服务端达成上述消息的共识：
- Socket：由IP地址和端口号组成
- 序列号：用来解决乱序问题
- 窗口大小：流量控制

### 如何唯一确定一个TCP连接？
通过一个四元组：(源地址、源端口、目标地址、目标端口)

其中，源地址和目标地址是不在TCP头部的，在IP中，32位。源端口和目标端口则在TCP头部，64位。

#### 有一个 IP 的服务端监听了一个端口，它的 TCP 的最大连接数是多少？